/*! For license information please see yeim-uni-sdk.min.js.LICENSE.txt */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var s=t();for(var o in s)("object"==typeof exports?exports:e)[o]=s[o]}}(self,(()=>(()=>{"use strict";var e={d:(t,s)=>{for(var o in s)e.o(s,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:s[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{YeIMUniSDK:()=>Se,YeIMUniSDKDefines:()=>s,instance:()=>ke});var s={};function o(e,t=null){return{code:200,message:e,data:t}}function a(e,t=null){return{code:500,message:e,data:t}}function n(e,t,s=null){try{null!=e&&void 0!==e.success&&"function"==typeof e.success&&e.success(o(t,s))}catch(e){console.error(e)}}function i(e,t,s=null){try{null!=e&&void 0!==e.fail&&"function"==typeof e.fail&&e.fail(a(t,s))}catch(e){console.error(e)}}function r(e,t){uni.$emit(ke.defaults.eventPrefix+e,t)}function d(e,t){e&&uni.$on(ke.defaults.eventPrefix+e,t)}function u(e,t){e&&uni.$off(ke.defaults.eventPrefix+e,t)}s.EVENT={},s.EVENT.NET_CHANGED="net_changed",s.EVENT.CONVERSATION_LIST_CHANGED="conversation_list_changed",s.EVENT.MESSAGE_RECEIVED="message_received",s.EVENT.PRIVATE_READ_RECEIPT="private_read_receipt",s.EVENT.KICKED_OUT="kicked_out",s.CONVERSATION_TYPE={},s.CONVERSATION_TYPE.PRIVATE="private",s.CONVERSATION_TYPE.GROUP="group",s.MESSAGE_TYPE={},s.MESSAGE_TYPE.TEXT="text",s.MESSAGE_TYPE.IMAGE="image",s.MESSAGE_TYPE.AUDIO="audio",s.MESSAGE_TYPE.VIDEO="video",s.MESSAGE_TYPE.LOCATION="location",s.MESSAGE_TYPE.CUSTOM="custom",s.MESSAGE_TYPE.GROUP_SYS_NOTICE="group_sys_notice",s.GROUP={},s.GROUP.JOINMODE={},s.GROUP.JOINMODE.FREE=1,s.GROUP.JOINMODE.CHECK=2,s.GROUP.JOINMODE.FORBIDDEN=3,s.GROUP.APPLYSTATUS={},s.GROUP.APPLYSTATUS.PENDING=1,s.GROUP.APPLYSTATUS.AGREE=2,s.GROUP.APPLYSTATUS.REFUSE=3;const c=function(e,t){if(0==ke.defaults.logLevel)console.log("【YeIMUniSDK Log】",t);else{if(2==ke.defaults.logLevel)return;1==e&&console.log("【YeIMUniSDK Log】",t)}};var l=function(e,t){return e<<t|e>>>32-t},f=function(e,t){var s,o,a,n,i;return a=2147483648&e,n=2147483648&t,i=(1073741823&e)+(1073741823&t),(s=1073741824&e)&(o=1073741824&t)?2147483648^i^a^n:s|o?1073741824&i?3221225472^i^a^n:1073741824^i^a^n:i^a^n},p=function(e,t,s,o,a,n,i){return e=f(e,f(f(function(e,t,s){return e&t|~e&s}(t,s,o),a),i)),f(l(e,n),t)},g=function(e,t,s,o,a,n,i){return e=f(e,f(f(function(e,t,s){return e&s|t&~s}(t,s,o),a),i)),f(l(e,n),t)},h=function(e,t,s,o,a,n,i){return e=f(e,f(f(function(e,t,s){return e^t^s}(t,s,o),a),i)),f(l(e,n),t)},m=function(e,t,s,o,a,n,i){return e=f(e,f(f(function(e,t,s){return t^(e|~s)}(t,s,o),a),i)),f(l(e,n),t)},y=function(e){var t,s="",o="";for(t=0;t<=3;t++)s+=(o="0"+(e>>>8*t&255).toString(16)).substr(o.length-2,2);return s};const I=function(e){e+="";var t,s,o,a,n,i,r,d,u,c=Array();for(e=function(e){e=e.replace(/\x0d\x0a/g,"\n");for(var t="",s=0;s<e.length;s++){var o=e.charCodeAt(s);o<128?t+=String.fromCharCode(o):o>127&&o<2048?(t+=String.fromCharCode(o>>6|192),t+=String.fromCharCode(63&o|128)):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128),t+=String.fromCharCode(63&o|128))}return t}(e),c=function(e){for(var t,s=e.length,o=s+8,a=16*((o-o%64)/64+1),n=Array(a-1),i=0,r=0;r<s;)i=r%4*8,n[t=(r-r%4)/4]=n[t]|e.charCodeAt(r)<<i,r++;return i=r%4*8,n[t=(r-r%4)/4]=n[t]|128<<i,n[a-2]=s<<3,n[a-1]=s>>>29,n}(e),i=1732584193,r=4023233417,d=2562383102,u=271733878,t=0;t<c.length;t+=16)s=i,o=r,a=d,n=u,i=p(i,r,d,u,c[t+0],7,3614090360),u=p(u,i,r,d,c[t+1],12,3905402710),d=p(d,u,i,r,c[t+2],17,606105819),r=p(r,d,u,i,c[t+3],22,3250441966),i=p(i,r,d,u,c[t+4],7,4118548399),u=p(u,i,r,d,c[t+5],12,1200080426),d=p(d,u,i,r,c[t+6],17,2821735955),r=p(r,d,u,i,c[t+7],22,4249261313),i=p(i,r,d,u,c[t+8],7,1770035416),u=p(u,i,r,d,c[t+9],12,2336552879),d=p(d,u,i,r,c[t+10],17,4294925233),r=p(r,d,u,i,c[t+11],22,2304563134),i=p(i,r,d,u,c[t+12],7,1804603682),u=p(u,i,r,d,c[t+13],12,4254626195),d=p(d,u,i,r,c[t+14],17,2792965006),r=p(r,d,u,i,c[t+15],22,1236535329),i=g(i,r,d,u,c[t+1],5,4129170786),u=g(u,i,r,d,c[t+6],9,3225465664),d=g(d,u,i,r,c[t+11],14,643717713),r=g(r,d,u,i,c[t+0],20,3921069994),i=g(i,r,d,u,c[t+5],5,3593408605),u=g(u,i,r,d,c[t+10],9,38016083),d=g(d,u,i,r,c[t+15],14,3634488961),r=g(r,d,u,i,c[t+4],20,3889429448),i=g(i,r,d,u,c[t+9],5,568446438),u=g(u,i,r,d,c[t+14],9,3275163606),d=g(d,u,i,r,c[t+3],14,4107603335),r=g(r,d,u,i,c[t+8],20,1163531501),i=g(i,r,d,u,c[t+13],5,2850285829),u=g(u,i,r,d,c[t+2],9,4243563512),d=g(d,u,i,r,c[t+7],14,1735328473),r=g(r,d,u,i,c[t+12],20,2368359562),i=h(i,r,d,u,c[t+5],4,4294588738),u=h(u,i,r,d,c[t+8],11,2272392833),d=h(d,u,i,r,c[t+11],16,1839030562),r=h(r,d,u,i,c[t+14],23,4259657740),i=h(i,r,d,u,c[t+1],4,2763975236),u=h(u,i,r,d,c[t+4],11,1272893353),d=h(d,u,i,r,c[t+7],16,4139469664),r=h(r,d,u,i,c[t+10],23,3200236656),i=h(i,r,d,u,c[t+13],4,681279174),u=h(u,i,r,d,c[t+0],11,3936430074),d=h(d,u,i,r,c[t+3],16,3572445317),r=h(r,d,u,i,c[t+6],23,76029189),i=h(i,r,d,u,c[t+9],4,3654602809),u=h(u,i,r,d,c[t+12],11,3873151461),d=h(d,u,i,r,c[t+15],16,530742520),r=h(r,d,u,i,c[t+2],23,3299628645),i=m(i,r,d,u,c[t+0],6,4096336452),u=m(u,i,r,d,c[t+7],10,1126891415),d=m(d,u,i,r,c[t+14],15,2878612391),r=m(r,d,u,i,c[t+5],21,4237533241),i=m(i,r,d,u,c[t+12],6,1700485571),u=m(u,i,r,d,c[t+3],10,2399980690),d=m(d,u,i,r,c[t+10],15,4293915773),r=m(r,d,u,i,c[t+1],21,2240044497),i=m(i,r,d,u,c[t+8],6,1873313359),u=m(u,i,r,d,c[t+15],10,4264355552),d=m(d,u,i,r,c[t+6],15,2734768916),r=m(r,d,u,i,c[t+13],21,1309151649),i=m(i,r,d,u,c[t+4],6,4149444226),u=m(u,i,r,d,c[t+11],10,3174756917),d=m(d,u,i,r,c[t+2],15,718787259),r=m(r,d,u,i,c[t+9],21,3951481745),i=f(i,s),r=f(r,o),d=f(d,a),u=f(u,n);return(y(i)+y(r)+y(d)+y(u)).toLowerCase()};var v,T,P,k,S,b=b||function(e,t){var s={},o=s.lib={},a=function(){},n=o.Base={extend:function(e){a.prototype=this;var t=new a;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},i=o.WordArray=n.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||d).stringify(this)},concat:function(e){var t=this.words,s=e.words,o=this.sigBytes;if(e=e.sigBytes,this.clamp(),o%4)for(var a=0;a<e;a++)t[o+a>>>2]|=(s[a>>>2]>>>24-a%4*8&255)<<24-(o+a)%4*8;else if(65535<s.length)for(a=0;a<e;a+=4)t[o+a>>>2]=s[a>>>2];else t.push.apply(t,s);return this.sigBytes+=e,this},clamp:function(){var t=this.words,s=this.sigBytes;t[s>>>2]&=4294967295<<32-s%4*8,t.length=e.ceil(s/4)},clone:function(){var e=n.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var s=[],o=0;o<t;o+=4)s.push(4294967296*e.random()|0);return new i.init(s,t)}}),r=s.enc={},d=r.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var s=[],o=0;o<e;o++){var a=t[o>>>2]>>>24-o%4*8&255;s.push((a>>>4).toString(16)),s.push((15&a).toString(16))}return s.join("")},parse:function(e){for(var t=e.length,s=[],o=0;o<t;o+=2)s[o>>>3]|=parseInt(e.substr(o,2),16)<<24-o%8*4;return new i.init(s,t/2)}},u=r.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var s=[],o=0;o<e;o++)s.push(String.fromCharCode(t[o>>>2]>>>24-o%4*8&255));return s.join("")},parse:function(e){for(var t=e.length,s=[],o=0;o<t;o++)s[o>>>2]|=(255&e.charCodeAt(o))<<24-o%4*8;return new i.init(s,t)}},c=r.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},l=o.BufferedBlockAlgorithm=n.extend({reset:function(){this._data=new i.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var s=this._data,o=s.words,a=s.sigBytes,n=this.blockSize,r=a/(4*n);if(t=(r=t?e.ceil(r):e.max((0|r)-this._minBufferSize,0))*n,a=e.min(4*t,a),t){for(var d=0;d<t;d+=n)this._doProcessBlock(o,d);d=o.splice(0,t),s.sigBytes-=a}return new i.init(d,a)},clone:function(){var e=n.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});o.Hasher=l.extend({cfg:n.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,s){return new e.init(s).finalize(t)}},_createHmacHelper:function(e){return function(t,s){return new f.HMAC.init(e,s).finalize(t)}}});var f=s.algo={};return s}(Math);T=(S=(v=b).lib).WordArray,P=S.Hasher,k=[],S=v.algo.SHA1=P.extend({_doReset:function(){this._hash=new T.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var s=this._hash.words,o=s[0],a=s[1],n=s[2],i=s[3],r=s[4],d=0;80>d;d++){if(16>d)k[d]=0|e[t+d];else{var u=k[d-3]^k[d-8]^k[d-14]^k[d-16];k[d]=u<<1|u>>>31}u=(o<<5|o>>>27)+r+k[d],u=20>d?u+(1518500249+(a&n|~a&i)):40>d?u+(1859775393+(a^n^i)):60>d?u+((a&n|a&i|n&i)-1894007588):u+((a^n^i)-899497514),r=i,i=n,n=a<<30|a>>>2,a=o,o=u}s[0]=s[0]+o|0,s[1]=s[1]+a|0,s[2]=s[2]+n|0,s[3]=s[3]+i|0,s[4]=s[4]+r|0},_doFinalize:function(){var e=this._data,t=e.words,s=8*this._nDataBytes,o=8*e.sigBytes;return t[o>>>5]|=128<<24-o%32,t[14+(o+64>>>9<<4)]=Math.floor(s/4294967296),t[15+(o+64>>>9<<4)]=s,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=P.clone.call(this);return e._hash=this._hash.clone(),e}}),v.SHA1=P._createHelper(S),v.HmacSHA1=P._createHmacHelper(S),function(){var e=b,t=e.enc.Utf8;e.algo.HMAC=e.lib.Base.extend({init:function(e,s){e=this._hasher=new e.init,"string"==typeof s&&(s=t.parse(s));var o=e.blockSize,a=4*o;s.sigBytes>a&&(s=e.finalize(s)),s.clamp();for(var n=this._oKey=s.clone(),i=this._iKey=s.clone(),r=n.words,d=i.words,u=0;u<o;u++)r[u]^=1549556828,d[u]^=909522486;n.sigBytes=i.sigBytes=a,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}})}();const E=b;async function U(){let e=await uni.request({url:ke.defaults.baseURL+"/upload/sign",data:{},method:"GET",header:{"content-type":"application/json",token:ke.token}});if("[object Array]"===Object.prototype.toString.call(e)&&(e=e.pop()),e&&e.data&&e.data.data){let t=e.data.data;ke.mediaUploadParams=t}else c(1,"媒体上传参数获取失败！")}function _(){let e="";return"cos"==ke.mediaUploadParams.storage?e="https://"+ke.mediaUploadParams.bucket+".cos."+ke.mediaUploadParams.region+".myqcloud.com":"oss"==ke.mediaUploadParams.storage?e="https://"+ke.mediaUploadParams.bucket+"."+ke.mediaUploadParams.region+".aliyuncs.com":"local"==ke.mediaUploadParams.storage&&(e=ke.defaults.baseURL),e}function A(){return ke.mediaUploadParams.customDomain?ke.mediaUploadParams.customDomain:_()}function L(e,t="files"){let s=e;if(!ke.mediaUploadParams.baseDir&&"local"==!ke.mediaUploadParams.storage)return s;{let o=ke.mediaUploadParams.baseDir,a=new Date,n=t+"/"+a.getFullYear()+"-"+JSON.stringify(a.getMonth()+1).padStart(2,0)+"-"+JSON.stringify(a.getDate()).padStart(2,0)+"/"+e;if("local"!=ke.mediaUploadParams.storage){if("/"==o.substring(0,1)&&(o=o.substring(1)),"/"==o.substring(o.length-1,o.length)&&(o=o.substring(0,o.length)+o.substring(o.length+1)),!o)return n;s=o+"/"+n}else s=n}return s}async function C(e,t,s){let o=parseInt((new Date).getTime()/1e3)-1;(!ke.mediaUploadParams||o>ke.mediaUploadParams.expireTime)&&await U();let a=ke.mediaUploadParams.nowTime,n=ke.mediaUploadParams.expireTime,i=ke.mediaUploadParams.secretId,r=a+";"+n,d=a+";"+n,u=ke.mediaUploadParams.signKey,c=e+"\n"+t+"\n\n"+s+"\n",l="sha1\n"+d+"\n"+E.SHA1(c)+"\n";return"q-sign-algorithm=sha1&q-ak="+i+"&q-sign-time="+r+"&q-key-time="+d+"&q-header-list=&q-url-param-list=&q-signature="+E.HmacSHA1(l,u)}async function O(){let e=parseInt((new Date).getTime()/1e3)-1;return(!ke.mediaUploadParams||e>ke.mediaUploadParams.expireTime)&&await U(),ke.mediaUploadParams}function N(e){if(!ke.checkLogged())return i(e,"请登陆后再试");if(!ke.mediaUploadParams)return c(1,"上传参数获取失败！");let t=ke.mediaUploadParams,s=e.filename.substring(e.filename.lastIndexOf(".")),o=I((new Date).getTime()+"_"+e.filename)+"_other"+s,a=_(),r=A()+"/"+L(o);if("cos"==t.storage)setTimeout((async()=>{let t=await C("post","/",""),s=uni.uploadFile({url:a,name:"file",formData:{key:L(o),success_action_status:200,Signature:t,"Content-Type":""},header:{Authorization:t},filePath:e.filepath,success:t=>{n(e,"success",{url:r})},fail:t=>{i(e,t)}});void 0!==e.onProgress&&"function"==typeof e.onProgress&&s.onProgressUpdate((t=>{e.onProgress(t)}))}),0);else if("oss"==t.storage)setTimeout((async()=>{await O();let s=uni.uploadFile({url:a,name:"file",formData:{key:L(o),policy:t.policyBase64,OSSAccessKeyId:t.accessKeyId,success_action_status:200,signature:t.signature},filePath:e.filepath,success:t=>{n(e,"success",{url:r})},fail:t=>{i(e,t)}});void 0!==e.onProgress&&"function"==typeof e.onProgress&&s.onProgressUpdate((t=>{e.onProgress(t)}))}));else if("local"==t.storage){let t=uni.uploadFile({url:a+"/upload",name:"file",formData:{key:L(o)},header:{token:ke.token},filePath:e.filepath,success:t=>{let s=JSON.parse(t.data);200==s.code?n(e,"success",{url:A()+s.data.url}):i(e,s.message)},fail:t=>{i(e,t)}});void 0!==e.onProgress&&"function"==typeof e.onProgress&&t.onProgressUpdate((t=>{e.onProgress(t)}))}}function R(e){if(!ke.mediaUploadParams)return c(1,"媒体上传参数获取失败！");let t=ke.mediaUploadParams,s=e.filename.substring(e.filename.lastIndexOf(".")),o=I((new Date).getTime()+"_"+e.filename)+"_image"+s,a=_(),r=A()+"/"+L(o,"image");if("cos"==t.storage)setTimeout((async()=>{let t=await C("post","/",""),s=uni.uploadFile({url:a,name:"file",formData:{key:L(o,"image"),success_action_status:200,Signature:t,"Content-Type":""},header:{Authorization:t},filePath:e.filepath,success:()=>{let t=0,s=0;if(e.height>198){let o=198/e.height;t=parseInt(e.height*o),s=parseInt(e.width*o)}else if(e.width>198){let o=198/e.width;t=parseInt(e.height*o),s=parseInt(e.width*o)}n(e,"success",{url:r,thumbnailUrl:r+"?imageMogr2/thumbnail/"+s+"x"+t,thumbnailWidth:s,thumbnailHeight:t})},fail:t=>{i(e,t)}});void 0!==e.onProgress&&"function"==typeof e.onProgress&&s.onProgressUpdate((t=>{e.onProgress(t)}))}),0);else if("oss"==t.storage)setTimeout((async()=>{await O();let s=uni.uploadFile({url:a,name:"file",formData:{key:L(o,"image"),policy:t.policyBase64,OSSAccessKeyId:t.accessKeyId,success_action_status:200,signature:t.signature},filePath:e.filepath,success:()=>{let t=0,s=0;if(e.height>198){let o=198/e.height;t=parseInt(e.height*o),s=parseInt(e.width*o)}else if(e.width>198){let o=198/e.width;t=parseInt(e.height*o),s=parseInt(e.width*o)}n(e,"success",{url:r,thumbnailUrl:r+"?x-oss-process=image/resize,m_fixed,h_"+t+",w_"+s,thumbnailWidth:s,thumbnailHeight:t})},fail:t=>{i(e,t)}});void 0!==e.onProgress&&"function"==typeof e.onProgress&&s.onProgressUpdate((t=>{e.onProgress(t)}))}));else if("local"==t.storage){console.log(L(o,"image"));let t=uni.uploadFile({url:a+"/upload/image",name:"file",formData:{key:L(o,"image")},header:{token:ke.token},filePath:e.filepath,success:t=>{let s=JSON.parse(t.data);200==s.code?n(e,"success",{url:A()+s.data.url,thumbnailUrl:A()+s.data.thumbnailUrl,thumbnailWidth:s.data.thumbnailWidth,thumbnailHeight:s.data.thumbnailHeight}):i(e,s.message)},fail:t=>{i(e,t)}});void 0!==e.onProgress&&"function"==typeof e.onProgress&&t.onProgressUpdate((t=>{e.onProgress(t)}))}}const x=function(e){return{conversationId:e.to,conversationType:e.conversationType,fromUserInfo:{nickname:ke.user.nickname,avatarUrl:ke.user.avatarUrl},from:ke.userId,to:e.to,type:e.type,isRead:0,isRevoke:0,isDeleted:0,status:"unSend",time:(new Date).getTime(),body:e.body,extra:e.extra?e.extra:""}};function M(e){if(!ke.userId)return a("请登陆后再调用此接口");if(null==e||!e.toId)return a("toId 不能为空");if(!e.conversationType)return a("conversationType 不能为空");if(!e.body||!e.body.text)return a("text 不能为空");let t={to:e.toId,type:s.MESSAGE_TYPE.TEXT,conversationType:e.conversationType,body:{text:e.body.text}};return e.extra&&(t.extra=e.extra),x(t)}function w(e){if(!ke.userId)return a("请登陆后再调用此接口");if(null==e||!e.toId)return a("toId 不能为空");if(!e.conversationType)return a("conversationType 不能为空");if(!e.body||!e.body.file)return a("file 不能为空");if(!e.body.file.tempFilePath)return a("tempFilePath 不能为空");if(!e.body.file.width)return a("width 不能为空");if(!e.body.file.height)return a("height 不能为空");let t={to:e.toId,type:s.MESSAGE_TYPE.IMAGE,conversationType:e.conversationType,body:{originalUrl:e.body.file.tempFilePath,originalWidth:e.body.file.width,originalHeight:e.body.file.height,thumbnailUrl:e.body.file.tempFilePath,thumbnailWidth:e.body.file.width,thumbnailHeight:e.body.file.height}};e.extra&&(t.extra=e.extra);let o=x(t);return void 0!==e.onProgress&&"function"==typeof e.onProgress&&(o.onProgress=e.onProgress),o}function G(e){if(!ke.userId)return a("请登陆后再调用此接口");if(null==e||!e.toId)return a("toId 不能为空");if(!e.conversationType)return a("conversationType 不能为空");if(!e.body.address)return a("address 不能为空");if(!e.body.description)return a("description 不能为空");if(!e.body.longitude)return a("longitude 不能为空");if(!e.body.latitude)return a("latitude 不能为空");let t={to:e.toId,type:s.MESSAGE_TYPE.LOCATION,conversationType:e.conversationType,body:{address:e.body.address,description:e.body.description,longitude:e.body.longitude,latitude:e.body.latitude}};return e.extra&&(t.extra=e.extra),x(t)}function D(e){if(!ke.userId)return a("请登陆后再调用此接口");if(null==e||!e.toId)return a("toId 不能为空");if(!e.conversationType)return a("conversationType 不能为空");if(!e.body||!e.body.file)return a("file 不能为空");if(!e.body.file.tempFilePath)return a("tempFilePath 不能为空");if(!e.body.file.duration)return a("duration 不能为空");let t={to:e.toId,type:s.MESSAGE_TYPE.AUDIO,conversationType:e.conversationType,body:{audioUrl:e.body.file.tempFilePath,duration:e.body.file.duration}};e.extra&&(t.extra=e.extra);let o=x(t);return void 0!==e.onProgress&&"function"==typeof e.onProgress&&(o.onProgress=e.onProgress),o}function q(e){if(!ke.userId)return a("请登陆后再调用此接口");if(null==e||!e.toId)return a("toId 不能为空");if(!e.conversationType)return a("conversationType 不能为空");if(!e.body||!e.body.file)return a("file 不能为空");if(!e.body.file.duration)return a("duration 不能为空");if(!e.body.file.tempFilePath)return a("tempFilePath 不能为空");if(!e.body.file.width)return a("width 不能为空");if(!e.body.file.height)return a("height 不能为空");let t={to:e.toId,type:s.MESSAGE_TYPE.VIDEO,conversationType:e.conversationType,body:{videoUrl:e.body.file.tempFilePath,thumbnailUrl:"",duration:e.body.file.duration,videoWidth:e.body.file.width,videoHeight:e.body.file.height}};e.extra&&(t.extra=e.extra);let o=x(t);return void 0!==e.onProgress&&"function"==typeof e.onProgress&&(o.onProgress=e.onProgress),o}function H(e){if(!ke.userId)return a("请登陆后再试");if(null==e||!e.toId)return a("toId 不能为空");if(!e.conversationType)return a("conversationType 不能为空");if(!e.body)return a("自定义消息的 body 不能为空");let t={to:e.toId,type:s.MESSAGE_TYPE.CUSTOM,conversationType:e.conversationType,body:e.body};return e.extra&&(t.extra=e.extra),x(t)}function j(e){if(!ke.checkLogged())return i(e,"请登陆后再试");if(!e.message)return i(e,"message 不能为空");let t=e.message;t.type==s.MESSAGE_TYPE.TEXT?B(e):t.type==s.MESSAGE_TYPE.IMAGE?function(e){let t=e.message;R({filename:ke.token+"_image.png",filepath:t.body.originalUrl,width:t.body.originalWidth,height:t.body.originalHeight,success:s=>{t.body.originalUrl=s.data.url,t.body.thumbnailWidth=s.data.thumbnailWidth,t.body.thumbnailHeight=s.data.thumbnailHeight,t.body.thumbnailUrl=s.data.thumbnailUrl,e.message=t,B(e)},fail:e=>{c(1,e)},onProgress:e=>{void 0!==t.onProgress&&"function"==typeof t.onProgress&&t.onProgress(e)}})}(e):t.type==s.MESSAGE_TYPE.VIDEO?function(e){let t=e.message;!function(e){if(!ke.mediaUploadParams)return c(1,"媒体上传参数获取失败！");let t=ke.mediaUploadParams,s=e.filename.substring(e.filename.lastIndexOf(".")),o=I((new Date).getTime()+"_"+e.filename)+"_video"+s,a=_(),r=A()+"/"+L(o,"video");if("cos"==t.storage)setTimeout((async()=>{let t=await C("post","/",""),s=uni.uploadFile({url:a,name:"file",formData:{key:L(o,"video"),success_action_status:200,Signature:t,"Content-Type":""},header:{Authorization:t},filePath:e.filepath,success:async()=>{let t=await C("get","/"+L(o,"video"),"");uni.downloadFile({url:a+"/"+L(o,"video")+"?ci-process=snapshot&time=1",header:{Authorization:t},success:t=>{200===t.statusCode?R({filename:I(o+t.tempFilePath)+"_videoThumb.jpg",filepath:t.tempFilePath,success:t=>{n(e,"success",{videoUrl:r,thumbnailUrl:t.data.url})},fail:t=>{i(e,t)}}):i(e,"腾讯云媒体截图接口：下载视频缩略图失败")},fail:t=>{i(e,"腾讯云媒体截图接口：下载视频缩略图失败")}})},fail:t=>{i(e,t)}});void 0!==e.onProgress&&"function"==typeof e.onProgress&&s.onProgressUpdate((t=>{e.onProgress(t)}))}),0);else if("oss"==t.storage)setTimeout((async()=>{await O();let s=uni.uploadFile({url:a,name:"file",formData:{key:L(o,"video"),policy:t.policyBase64,OSSAccessKeyId:t.accessKeyId,success_action_status:200,signature:t.signature},filePath:e.filepath,success:t=>{n(e,"success",{videoUrl:r,thumbnailUrl:r+"?x-oss-process=video/snapshot,t_1000,f_jpg,m_fast"})},fail:t=>{i(e,t)}});void 0!==e.onProgress&&"function"==typeof e.onProgress&&s.onProgressUpdate((t=>{e.onProgress(t)}))}));else if("local"==t.storage){let t=uni.uploadFile({url:a+"/upload/video",name:"file",formData:{key:L(o,"video")},header:{token:ke.token},filePath:e.filepath,success:t=>{let s=JSON.parse(t.data);200==s.code?n(e,"success",{videoUrl:A()+s.data.url,thumbnailUrl:A()+s.data.thumbnailUrl}):i(e,s.message)},fail:t=>{i(e,t)}});void 0!==e.onProgress&&"function"==typeof e.onProgress&&t.onProgressUpdate((t=>{e.onProgress(t)}))}}({filename:ke.token+"_video.mp4",filepath:t.body.videoUrl,success:s=>{let o=s.data.videoUrl,a=s.data.thumbnailUrl;t.body.videoUrl=o,t.body.thumbnailUrl=a,e.message=t,B(e)},fail:e=>{c(1,e)},onProgress:e=>{void 0!==t.onProgress&&"function"==typeof t.onProgress&&t.onProgress(e)}})}(e):t.type==s.MESSAGE_TYPE.AUDIO?function(e){let t=e.message;!function(e){if(!ke.mediaUploadParams)return c(1,"媒体上传参数获取失败！");let t=ke.mediaUploadParams,s=e.filename.substring(e.filename.lastIndexOf(".")),o=I((new Date).getTime()+"_"+e.filename)+"_audio"+s,a=_(),r=A()+"/"+L(o,"audio");if("cos"==t.storage)setTimeout((async()=>{let t=await C("post","/",""),s=uni.uploadFile({url:a,name:"file",formData:{key:L(o,"audio"),success_action_status:200,Signature:t,"Content-Type":""},header:{Authorization:t},filePath:e.filepath,success:t=>{n(e,"success",{url:r})},fail:t=>{i(e,t)}});void 0!==e.onProgress&&"function"==typeof e.onProgress&&s.onProgressUpdate((t=>{e.onProgress(t)}))}),0);else if("oss"==t.storage)setTimeout((async()=>{await O();let s=uni.uploadFile({url:a,name:"file",formData:{key:L(o,"audio"),policy:t.policyBase64,OSSAccessKeyId:t.accessKeyId,success_action_status:200,signature:t.signature},filePath:e.filepath,success:t=>{n(e,"success",{url:r})},fail:t=>{i(e,t)}});void 0!==e.onProgress&&"function"==typeof e.onProgress&&s.onProgressUpdate((t=>{e.onProgress(t)}))}));else if("local"==t.storage){let t=uni.uploadFile({url:a+"/upload",name:"file",formData:{key:L(o,"audio")},header:{token:ke.token},filePath:e.filepath,success:t=>{let s=JSON.parse(t.data);200==s.code?n(e,"success",{url:A()+s.data.url}):i(e,s.message)},fail:t=>{i(e,t)}});void 0!==e.onProgress&&"function"==typeof e.onProgress&&t.onProgressUpdate((t=>{e.onProgress(t)}))}}({filename:ke.token+"_audio.aac",filepath:t.body.audioUrl,success:s=>{let o=s.data.url;t.body.audioUrl=o,e.message=t,B(e)},fail:e=>{c(1,e)},onProgress:e=>{void 0!==t.onProgress&&"function"==typeof t.onProgress&&t.onProgress(e)}})}(e):t.type==s.MESSAGE_TYPE.LOCATION&&B(e)}function B(e){let t=e.message;uni.request({url:ke.defaults.baseURL+"/message/save",data:t,method:"POST",header:{"content-type":"application/json",token:ke.token},success:t=>{if(200==t.data.code){let s=t.data.data;F(s),n(e,"接口调用成功",s)}else i(e,t.data.message)},fail:t=>{i(e,t)}})}function F(e){if(!e.conversationId)return c(1,"message.conversationId 不能为空");let t=z(e.conversationId),s=t.findIndex((t=>t.messageId===e.messageId)),o="yeim:messageList:"+I(ke.userId)+":conversationId:"+I(e.conversationId);-1===s?(t.length>19&&t.splice(0,t.length-19),t.push(e),uni.setStorageSync(o,t)):(t[s]=e,uni.setStorageSync(o,t))}function V(e){if(!ke.checkLogged())return i(e,"请登陆后再试");if(!e.conversationId)return i(e,"conversationId 不能为空");let t=20;if(e.limit&&"number"==typeof e.limit&&(t=e.limit),e.nextMessageId){let s=e.nextMessageId,o=z(e.conversationId),a=o.findIndex((e=>e.messageId===s));if(-1===a)Y(e.conversationId,s,t).then((t=>{n(e,"接口调用成功",t)})).catch((t=>{i(e,t)}));else{let s=o[a];if(o=o.slice(0,a),o.length<t){let a=t-o.length,r=null;r=0==o.length?s.messageId:o[0].messageId,Y(e.conversationId,r,a).then((t=>{let s=t.list;if(s&&s.length>0){let e=o.concat(s);e.sort(((e,t)=>e.sequence-t.sequence)),t.list=e}n(e,"接口调用成功",t)})).catch((t=>{i(e,t)}))}else n(e,"接口调用成功",{list:o,nextMessageId:o[0].messageId})}}else{let s=z(e.conversationId);if(s.length<t){let o=t-s.length,a=null;s.length>0&&(a=s[0].messageId),Y(e.conversationId,a,o).then((t=>{let o=t.list;if(o&&o.length>0){let a=s.concat(o);a.sort(((e,t)=>e.sequence-t.sequence));let n="yeim:messageList:"+I(ke.userId)+":conversationId:"+I(e.conversationId);uni.setStorageSync(n,a),t.list=a}n(e,"接口调用成功",t)})).catch((t=>{i(e,t)}))}else n(e,"接口调用成功",{list:s,nextMessageId:s[0].messageId})}}function Y(e,t=null,s=20){return new Promise(((s,o)=>{uni.request({url:ke.defaults.baseURL+"/v117/message/list",data:{nextMessageId:null==t||""==t?null:t,conversationId:e},method:"GET",header:{"content-type":"application/json",token:ke.token},success:e=>{if(200==e.data.code){let t={},o=e.data.data.records;o=o.reverse(),o.sort(((e,t)=>e.sequence-t.sequence)),t.list=o,e.data.data.nextMessageId&&(t.nextMessageId=e.data.data.nextMessageId),s(t)}else o(e.data.message)},fail:e=>{o(e),c(1,e)}})}))}function K(e){if(!ke.checkLogged())return i(e,"请登陆后再试");if(!e.conversationId)return i(e,"conversationId 不能为空");if(e.page&&parseFloat(e.page)||(e.page=1),1!=e.page)return J(e,e.page);let t=z(e.conversationId);if(t.length<=0)J(e,e.page);else{let s="yeim:conversationList:"+I(ke.userId),o=uni.getStorageSync(s);if(o=o||[],o<=0)return i(e,"会话不存在");{let s=o.findIndex((t=>t.conversationId===e.conversationId));if(-1===s)return i({code:500,message:"会话不存在"},e);if(o[s].lastMessage.messageId==t[t.length-1].messageId)return n(e,"接口调用成功",t);J(e,e.page)}}}function z(e){let t="yeim:messageList:"+I(ke.userId)+":conversationId:"+I(e),s=uni.getStorageSync(t);return s=s||[],s.sort(((e,t)=>e.sequence-t.sequence)),s}function J(e,t=1){uni.request({url:ke.defaults.baseURL+"/message/list",data:{page:t,conversationId:e.conversationId},method:"GET",header:{"content-type":"application/json",token:ke.token},success:s=>{if(200==s.data.code){let o=s.data.data.records;if(o=o.reverse(),o.sort(((e,t)=>e.sequence-t.sequence)),n(e,"接口调用成功",o),1==t){let t="yeim:messageList:"+I(ke.userId)+":conversationId:"+I(e.conversationId);uni.setStorageSync(t,o)}}else i(e,s.data.message)},fail:t=>{i(e,t),c(1,t)}})}function W(e){return ke.checkLogged()?e.message?e.message.messageId?void uni.request({url:ke.defaults.baseURL+"/message/delete",data:{messageId:e.message.messageId},method:"GET",header:{"content-type":"application/json",token:ke.token},success:t=>{200==t.data.code?(e.message.isDeleted=1,F(e.message),n(e,"删除成功",e.message)):i(e,t.data.message)},fail:t=>{c(1,t),i(e,t)}}):i(e,"message.messageId 不能为空"):i(e,"message 不能为空"):i(e,"请登陆后再试")}function $(e){return ke.checkLogged()?e.message?e.message.messageId?void uni.request({url:ke.defaults.baseURL+"/message/revoke",data:{messageId:e.message.messageId},method:"GET",header:{"content-type":"application/json",token:ke.token},success:t=>{200==t.data.code?(e.message.isRevoke=1,F(e.message),n(e,"撤回成功",e.message)):i(e,t.data.message)},fail:t=>{c(1,t),i(e,t)}}):i(e,"message.messageId 不能为空"):i(e,"message 不能为空"):i(e,"请登陆后再试")}function X(e){if(!ke.checkLogged())return a("请登陆后再试");if(!e)return a("conversationId 不能为空");let t="yeim:conversationList:"+I(ke.userId),s=uni.getStorageSync(t);s=s||[];let n=s.findIndex((t=>t.conversationId===e));return-1!==n?o("接口调用成功",s[n]):a("没有找到这个会话")}function Q(e){if(!ke.checkLogged())return i(e,"请登陆后再试");let t=e.page,s=e.limit,o="yeim:conversationList:"+I(ke.userId),a=uni.getStorageSync(o);a=a||[];let r=(t-1)*s;n(e,"接口调用成功",r+s>=a.length?a.slice(r,a.length):a.slice(r,r+s))}function Z(e){let t="yeim:conversationList:"+I(ke.userId);uni.setStorageSync(t,e),r(s.EVENT.CONVERSATION_LIST_CHANGED,e)}function ee(e){if(!ke.checkLogged())return a("请登陆后再试");let t="yeim:conversationList:"+I(ke.userId),o=uni.getStorageSync(t);o=o||[];let n=o.findIndex((t=>t.conversationId===e));-1!==n&&(o[n].unread=0,uni.setStorageSync(t,o)),uni.request({url:ke.defaults.baseURL+"/conversation/update/unread",data:{conversationId:e},method:"GET",header:{"content-type":"application/json",token:ke.token},success:e=>{},fail:e=>{c(1,e)}}),r(s.EVENT.CONVERSATION_LIST_CHANGED,o)}function te(e){if(!ke.checkLogged())return a("请登陆后再试");let t="yeim:conversationList:"+I(ke.userId),o=uni.getStorageSync(t);o=o||[];let n=o.findIndex((t=>t.conversationId===e));-1!==n&&(o.splice(n,1),uni.setStorageSync(t,o));let i="yeim:messageList:"+I(ke.userId)+":conversationId:"+I(e);uni.removeStorageSync(i),uni.request({url:ke.defaults.baseURL+"/conversation/delete",data:{conversationId:e},method:"GET",header:{"content-type":"application/json",token:ke.token},success:e=>{},fail:e=>{c(1,e)}}),r(s.EVENT.CONVERSATION_LIST_CHANGED,o)}function se(e){return ke.checkLogged()?e.name?e.avatarUrl?void uni.request({url:ke.defaults.baseURL+"/group/create",data:e,method:"POST",header:{"content-type":"application/json",token:ke.token},success:t=>{200==t.data.code?n(e,"创建成功"):i(e,t.data.message)},fail:t=>{i(e,t)}}):i(e,"avatarUrl 不能为空"):i(e,"name 不能为空"):i(e,"请登陆后再试")}function oe(e){return ke.checkLogged()?e.groupId?void uni.request({url:ke.defaults.baseURL+"/group/dissolve",data:{groupId:e.groupId},method:"GET",header:{token:ke.token},success:t=>{200==t.data.code?n(e,"解散成功"):i(e,t.data.message)},fail:t=>{i(e,t)}}):i(e,"groupId 不能为空"):i(e,"请登陆后再试")}function ae(e){return ke.checkLogged()?e.groupId?e.userId?void uni.request({url:ke.defaults.baseURL+"/group/transferLeader",data:{groupId:e.groupId,userId:e.userId},method:"GET",header:{token:ke.token},success:t=>{200==t.data.code?n(e,"转让成功"):i(e,t.data.message)},fail:t=>{i(e,t)}}):i(e,"userId 不能为空"):i(e,"groupId 不能为空"):i(e,"请登陆后再试")}function ne(e){return ke.checkLogged()?e.groupId?void uni.request({url:ke.defaults.baseURL+"/group/edit",data:e,method:"POST",header:{"content-type":"application/json",token:ke.token},success:t=>{200==t.data.code?n(e,"更新成功"):i(e,t.data.message)},fail:t=>{i(e,t)}}):i(e,"groupId 不能为空"):i(e,"请登陆后再试")}function ie(e){return ke.checkLogged()?e.groupId?void uni.request({url:ke.defaults.baseURL+"/group/get",data:{groupId:e.groupId},method:"GET",header:{token:ke.token},success:t=>{200==t.data.code?n(e,"接口调用成功",t.data.data):i(e,t.data.message)},fail:t=>{i(e,t)}}):i(e,"groupId 不能为空"):i(e,"请登陆后再试")}function re(e){if(!ke.checkLogged())return i(e,"请登陆后再试");uni.request({url:ke.defaults.baseURL+"/group/list",data:{},method:"GET",header:{token:ke.token},success:t=>{200==t.data.code?n(e,"接口调用成功",t.data.data):i(e,t.data.message)},fail:t=>{i(e,t)}})}function de(e){return ke.checkLogged()?e.groupId?void uni.request({url:ke.defaults.baseURL+"/group/user/add",data:{groupId:e.groupId,members:[ke.userId]},method:"POST",header:{"content-type":"application/json",token:ke.token},success:t=>{if(200==t.data.code){let o=t.data.data.group,a=t.data.data.successList;if(-1!=t.data.data.ignoreList.indexOf(ke.userId))return i(e,"已在当前群组，请勿重复加入");let r=!1;if(-1!=a.indexOf(ke.userId)&&(r=!0),!r)return i(e,"申请入群失败");o.joinMode==s.GROUP.JOINMODE.FREE?n(e,"成功加入群组"):o.joinMode==s.GROUP.JOINMODE.CHECK&&n(e,"已发送入群申请，请等待审核")}else i(e,t.data.message)},fail:t=>{i(e,t)}}):i(e,"groupId 不能为空"):i(e,"请登陆后再试")}function ue(e){return ke.checkLogged()?e.groupId?void uni.request({url:ke.defaults.baseURL+"/group/user/leave",data:{groupId:e.groupId},method:"GET",header:{token:ke.token},success:t=>{200==t.data.code?n(e,"退出成功"):i(e,t.data.message)},fail:t=>{i(e,t)}}):i(e,"groupId 不能为空"):i(e,"请登陆后再试")}function ce(e){return ke.checkLogged()?e.groupId?!e.members||e.members.length<=0?i(e,"members 不能为空"):void uni.request({url:ke.defaults.baseURL+"/group/user/add",data:{groupId:e.groupId,members:e.members},method:"POST",header:{"content-type":"application/json",token:ke.token},success:t=>{200==t.data.code?n(e,"接口调用成功",t.data.data):i(e,t.data.message)},fail:t=>{i(e,t)}}):i(e,"groupId 不能为空"):i(e,"请登陆后再试")}function le(e){return ke.checkLogged()?e.groupId?!e.members||e.members.length<=0?i(e,"members 不能为空"):void uni.request({url:ke.defaults.baseURL+"/group/user/delete",data:{groupId:e.groupId,members:e.members},method:"POST",header:{"content-type":"application/json",token:ke.token},success:t=>{200==t.data.code?n(e,"接口调用成功"):i(e,t.data.message)},fail:t=>{i(e,t)}}):i(e,"groupId 不能为空"):i(e,"请登陆后再试")}function fe(e){return ke.checkLogged()?e.groupId?void uni.request({url:ke.defaults.baseURL+"/group/user/list",data:{groupId:e.groupId},method:"GET",header:{token:ke.token},success:t=>{200==t.data.code?n(e,"接口调用成功",t.data.data):i(e,t.data.message)},fail:t=>{i(e,t)}}):i(e,"groupId 不能为空"):i(e,"请登陆后再试")}function pe(e){return ke.checkLogged()?e.groupId?void uni.request({url:ke.defaults.baseURL+"/group/user/set/adminstrator",data:{groupId:e.groupId,userId:e.userId,isAdmin:1===isAdmin?isAdmin:0},method:"GET",header:{token:ke.token},success:t=>{200==t.data.code?n(e,"接口调用成功"):i(e,t.data.message)},fail:t=>{i(e,t)}}):i(e,"groupId 不能为空"):i(e,"请登陆后再试")}function ge(e){return ke.checkLogged()?e.groupId?void uni.request({url:ke.defaults.baseURL+"/group/user/set/adminstrator",data:{groupId:e.groupId,userId:e.userId,isAdmin:1===e.isAdmin?e.isAdmin:0},method:"GET",header:{token:ke.token},success:t=>{200==t.data.code?n(e,"接口调用成功"):i(e,t.data.message)},fail:t=>{i(e,t)}}):i(e,"groupId 不能为空"):i(e,"请登陆后再试")}function he(e){return ke.checkLogged()?e.id?e.status?void uni.request({url:ke.defaults.baseURL+"/group/user/apply/change",data:{id:e.id,status:e.status},method:"GET",header:{token:ke.token},success:t=>{200==t.data.code?n(e,"接口调用成功"):i(e,t.data.message)},fail:t=>{i(e,t)}}):i(e,"status 不能为空"):i(e,"id 不能为空"):i(e,"请登陆后再试")}function me(e){return ke.checkLogged()?e.groupId?e.userId?(e.time||(e.time=0),void uni.request({url:ke.defaults.baseURL+"/group/user/set/mute",data:{groupId:e.groupId,userId:e.userId,time:e.time},method:"GET",header:{token:ke.token},success:t=>{200==t.data.code?n(e,"接口调用成功"):i(e,t.data.message)},fail:t=>{i(e,t)}})):i(e,"userId 不能为空"):i(e,"groupId 不能为空"):i(e,"请登陆后再试")}function ye(e){return ke.checkLogged()?e.userId?void uni.request({url:ke.defaults.baseURL+"/user/info",data:{userId:e.userId},method:"GET",header:{token:ke.token},success:t=>{n(e,"接口调用成功",t.data.data)},fail:t=>{i(e,t),log(1,t)}}):i(e,"userId 不能为空"):i(e,"请登陆后再试")}function Ie(e){return ke.checkLogged()?e.nickname?e.avatarUrl?void uni.request({url:ke.defaults.baseURL+"/user/update",data:{nickname:e.nickname,avatarUrl:e.avatarUrl},method:"POST",header:{"content-type":"application/json",token:ke.token},success:t=>{n(e,"接口调用成功")},fail:t=>{i(e,t),log(1,t)}}):i(e,"avatarUrl 不能为空"):i(e,"nickname 不能为空"):i(e,"请登陆后再试")}function ve(e){if(!ke.checkLogged())return i(e,"请登陆后再试");uni.request({url:ke.defaults.baseURL+"/user/black/list",data:{},method:"GET",header:{"content-type":"application/json",token:ke.token},success:t=>{200==t.data.code?n(e,"获取成功",t.data.data):i(e,t.data.message)},fail:t=>{i(e,t)}})}function Te(e){return ke.checkLogged()?e.members&&0!=e.members.length?void uni.request({url:ke.defaults.baseURL+"/user/black/add",data:{members:e.members},method:"POST",header:{"content-type":"application/json",token:ke.token},success:t=>{200==t.data.code?n(e,"添加成功"):i(e,t.data.message)},fail:t=>{i(e,t)}}):i(e,"members 不能为空"):i(e,"请登陆后再试")}function Pe(e){return ke.checkLogged()?e.members&&0!=e.members.length?void uni.request({url:ke.defaults.baseURL+"/user/black/remove",data:{members:e.members},method:"POST",header:{"content-type":"application/json",token:ke.token},success:t=>{200==t.data.code?n(e,"移除成功"):i(e,t.data.message)},fail:t=>{i(e,t)}}):i(e,"members 不能为空"):i(e,"请登陆后再试")}let ke;class Se{constructor(e={}){this.defaults={baseURL:void 0,socketURL:void 0,eventPrefix:"YeIM_",reConnectTotal:15,reConnectInterval:3e3,heartInterval:3e4,logLevel:0,notification:{autoPermission:!1,oppoChannelId:"Default",xiaomiChannelId:"high_system"},...e},this.version="1.1.7",this.systemInfo=uni.getSystemInfoSync(),this.firstConnect=!0,this.socketTask=void 0,this.socketLogged=!1,this.allowReconnect=!0,this.lockReconnect=!1,this.reConnectNum=0,this.connectTimer=void 0,this.heartTimer=void 0,this.checkTimer=void 0,this.user={},this.userId=void 0,this.token=void 0,this.mediaUploadParams={},this.mobileDeviceId=void 0,this.inApp=!0}static init(e={}){return ke||(ke=new Se(e),Se.prototype.createTextMessage=M,Se.prototype.createImageMessage=w,Se.prototype.createAudioMessage=D,Se.prototype.createVideoMessage=q,Se.prototype.createLocationMessage=G,Se.prototype.createCustomMessage=H,Se.prototype.upload=N,Se.prototype.sendMessage=j,Se.prototype.getMessageList=K,Se.prototype.getHistoryMessageList=V,Se.prototype.revokeMessage=$,Se.prototype.deleteMessage=W,Se.prototype.getConversation=X,Se.prototype.getConversationList=Q,Se.prototype.clearConversationUnread=ee,Se.prototype.deleteConversation=te,Se.prototype.getUserInfo=ye,Se.prototype.updateUserInfo=Ie,Se.prototype.getBlackUserList=ve,Se.prototype.addToBlackUserList=Te,Se.prototype.removeFromBlacklist=Pe,Se.prototype.addEventListener=d,Se.prototype.removeEventListener=u,Se.prototype.createGroup=se,Se.prototype.dissolveGroup=oe,Se.prototype.updateGroup=ne,Se.prototype.getGroup=ie,Se.prototype.transferLeader=ae,Se.prototype.getGroupList=re,Se.prototype.joinGroup=de,Se.prototype.leaveGroup=ue,Se.prototype.addGroupUsers=ce,Se.prototype.getGroupUserList=fe,Se.prototype.removeGroupUsers=le,Se.prototype.setAdminstrator=pe,Se.prototype.setMute=me,Se.prototype.getGroupApplyList=ge,Se.prototype.handleApply=he,c(1,"============= YeIMUniSDK 初始化成功！版本号："+ke.version+" ============="),ke)}static getInstance(){return ke||null}connect(e={}){if(!e.userId)return i(e,"userId 不能为空");if(!e.token)return i(e,"token 不能为空");let t=this.defaults.socketURL+"/"+e.userId+"/"+e.token;this.socketTask=uni.connectSocket({url:t,success:()=>{},fail:()=>{},complete:()=>{}}),this.socketTask.onOpen(this.socketOpen.bind(this)),this.socketTask.onClose(this.socketClose.bind(this)),this.socketTask.onError(this.socketError.bind(this)),this.socketTask.onMessage(this.socketMessage.bind(this)),this.connectTimer&&(clearTimeout(this.connectTimer),this.connectTimer=void 0),this.connectTimer=setTimeout((()=>(this.connectTimer=void 0,c(1,"连接服务端失败，请检查配置"),i(e,"网络异常，请稍后重试"))),this.defaults.reConnectInterval+1e3),this.socketTask.onMessage((t=>{if(this.socketLogged)return clearTimeout(this.connectTimer),void(this.connectTimer=void 0);clearTimeout(this.connectTimer),this.connectTimer=void 0;let s=JSON.parse(t.data);if(201==s.code){let t=s.data.user;this.user=t,this.userId=e.userId,this.token=e.token;let o=s.data.pushConfig;o.oppoChannelId&&(this.defaults.notification.oppoChannelId=o.oppoChannelId),o.xiaomiChannelId&&(this.defaults.notification.xiaomiChannelId=o.xiaomiChannelId),this.socketLogged=!0,this.reConnectNum=0,c(1,"IMServer登陆成功，登陆用户："+e.userId),uni.request({url:ke.defaults.baseURL+"/conversation/list",data:{page:1,limit:999999},method:"GET",header:{"content-type":"application/json",token:ke.token},success:e=>{200==e.data.code?Z(e.data.data.records):c(1,e.data.message)},fail:e=>{c(1,e)}}),U(),this.defaults.notification.autoPermission&&function(){if("app"==ke.systemInfo.uniPlatform&&"android"==ke.systemInfo.osName){var e=plus.android.runtimeMainActivity(),t=e.getPackageName(),s=e.getApplicationInfo().plusGetAttribute("uid"),o=plus.android.importClass("android.support.v4.app.NotificationManagerCompat");null==o&&(o=plus.android.importClass("androidx.core.app.NotificationManagerCompat"));var a=o.from(e).areNotificationsEnabled(),n=uni.getStorageSync("first_flag")||!1;a||n||(uni.setStorageSync("first_flag",!0),uni.showModal({title:"通知权限开启提醒",content:"您还没有开启通知权限，无法接受到消息通知，请前往设置！",showCancel:!1,confirmText:"去设置",success:function(o){if(o.confirm){var a=plus.android.importClass("android.content.Intent"),n=plus.android.importClass("android.os.Build");if(n.VERSION.SDK_INT>=26)(i=new a("android.settings.APP_NOTIFICATION_SETTINGS")).putExtra("android.provider.extra.APP_PACKAGE",t);else if(n.VERSION.SDK_INT>=21){var i;(i=new a("android.settings.APP_NOTIFICATION_SETTINGS")).putExtra("app_package",t),i.putExtra("app_uid",s)}else{i.setAction(Settings.ACTION_APPLICATION_DETAILS_SETTINGS);var r=Uri.fromParts("package",mainActivity.getPackageName(),null);i.setData(r)}e.startActivity(i)}}}))}else if("app"==ke.systemInfo.uniPlatform&&"ios"==ke.systemInfo.osName){var i=0,r=plus.ios.invoke("UIApplication","sharedApplication"),d=plus.ios.invoke(r,"currentUserNotificationSettings");d?(i=d.plusGetAttribute("types"),plus.ios.deleteObject(d)):i=plus.ios.invoke(r,"enabledRemoteNotificationTypes"),plus.ios.deleteObject(r),0==(0!=i)&&uni.showModal({title:"通知权限开启提醒",content:"您还没有开启通知权限，无法接受到消息通知，请前往设置！",showCancel:!1,confirmText:"去设置",success:function(e){if(e.confirm){var t=plus.ios.invoke("UIApplication","sharedApplication"),s=plus.ios.invoke("NSURL","URLWithString:","app-settings:");plus.ios.invoke(t,"openURL:",s),plus.ios.deleteObject(s),plus.ios.deleteObject(t)}}})}}(),function(){if("app"==ke.systemInfo.uniPlatform&&"android"==ke.systemInfo.osName&&ke.defaults.notification&&ke.defaults.notification.oppoChannelId&&plus.android.importClass("android.os.Build").VERSION.SDK_INT>=26){let e=ke.defaults.notification.oppoChannelId,t="聊天离线通知",s=plus.android.runtimeMainActivity(),o=plus.android.importClass("android.content.Context"),a=plus.android.importClass("android.app.NotificationManager"),n=s.getSystemService(o.NOTIFICATION_SERVICE),i=n.getNotificationChannel(e),r=plus.android.importClass("android.app.NotificationChannel"),d=plus.android.importClass("android.app.Notification");if(i&&n.deleteNotificationChannel(i),!i||null==i||"null"==i||null==i){let s=new r(e,t,a.IMPORTANCE_HIGH);s.setDescription("用于用户离线时推送消息通知"),s.enableVibration(!0),s.enableLights(!0),s.setBypassDnd(!0),s.setLockscreenVisibility(d.VISIBILITY_SECRET),n.createNotificationChannel(s)}}}(),ke.checkLogged()&&"app"==ke.systemInfo.uniPlatform&&plus.push.getClientInfoAsync((e=>{let t=e.clientid;t&&uni.request({url:ke.defaults.baseURL+"/user/bind/push/id",data:{clientId:t},method:"POST",header:{"content-type":"application/x-www-form-urlencoded",token:ke.token},success:e=>{let s=e.data;200==s.code?c(0,"注册APP用户离线通知推送标识符成功，当前获取的cid为："+t):c(1,"注册APP用户离线通知推送标识符异常："+s.message)},fail:e=>{c(1,e)}})}));let a=[];return uni.onPushMessage((e=>{if(!this.inApp&&"receive"==e.type){let t=e.data.__UUID__;a.indexOf(t)<=0&&(a.push(t),uni.createPushMessage({title:e.data.title,content:e.data.content,sound:"system",success:e=>{},fail:e=>{}}))}})),n(e,"登陆成功",t)}return i(e,s.message)}))}disConnect(){this.allowReconnect=!1,this.socketTask.close(),this.socketTask=void 0}reConnect(){if(this.allowReconnect&&!this.lockReconnect){if(!this.userId||!this.token)return void(this.allowReconnect=!1);if(this.defaults.reConnectTotal>0&&this.defaults.reConnectTotal<=this.reConnectNum)return void(this.allowReconnect=!1);this.reConnectNum++,this.lockReconnect=!0,r(s.EVENT.NET_CHANGED,"connecting"),setTimeout((()=>{c(1,"IMSDK 正在第"+this.reConnectNum+"次重连");try{this.connect({userId:this.userId,token:this.token})}catch(e){console.log(e)}this.lockReconnect=!1}),this.defaults.reConnectInterval)}}readyState(){return this.socketTask?this.socketTask.readyState:3}startHeartTimer(){this.clearHeartTimer(),this.socketTask&&(this.heartTimer=setTimeout((()=>{if(1==this.readyState()){let e={type:"heart",data:"ping"};this.socketTask.send({data:JSON.stringify(e)}),this.checkTimer=setTimeout((()=>{uni.closeSocket()}),this.defaults.heartInterval)}}),this.defaults.heartInterval))}clearHeartTimer(){return clearTimeout(this.heartTimer),clearTimeout(this.checkTimer),this}socketOpen(e){c(1,"YeIMUniSDK WebSocket成功连接"),r(s.EVENT.NET_CHANGED,"connected")}socketClose(e){c(1,"YeIMUniSDK WebSocket断开连接"),this.socketLogged=!1,this.socketTask=void 0,r(s.EVENT.NET_CHANGED,"closed"),this.reConnect()}socketError(e){c(1,e),this.reConnect()}socketMessage(e){if(c(0,e),this.startHeartTimer(),!this.socketLogged)return;let t=JSON.parse(e.data);t?this.socketMessageHandle(t):c(1,e)}socketMessageHandle(e){if(200==e.code){let t=e.data;F(t),r(s.EVENT.MESSAGE_RECEIVED,t)}else 203==e.code?function(e){let t="yeim:conversationList:"+I(ke.userId),s=uni.getStorageSync(t);s=s||[];let o=s.findIndex((t=>t.conversationId===e.conversationId));-1===o||s.splice(o,1),s.unshift(e),Z(s)}(e.data):205==e.code?function(e){if(!e)return c(1,"conversationId is null");let t="yeim:messageList:"+I(ke.userId)+":conversationId:"+I(e),o=uni.getStorageSync(t);if(o=o||[],o){let a=[];for(let e=0;e<o.length;e++){let t=o[e];"out"==t.direction&&(t.isRead=1,o[e].isRead=1,a.push(t))}uni.setStorageSync(t,o),r(s.EVENT.PRIVATE_READ_RECEIPT,{conversationId:e,list:a})}}(e.data.conversationId):109==e.code&&(this.allowReconnect=!1,this.clearHeartTimer(),uni.closeSocket(),r(s.EVENT.KICKED_OUT,!0),c(1,"用户："+this.userId+"，被踢下线了"))}checkLogged(){return!!(this.socketLogged&&this.userId&&this.token)||(c(1,"请登陆后再调用此方法"),!1)}intoApp(){this.inApp=!0}leaveApp(){this.inApp=!1}}return t})()));